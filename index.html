<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Zoltar Oracle</title>
  <script src="https://unpkg.com/gsap@3.12.5/dist/gsap.min.js"></script>
  <script src="https://unpkg.com/web3@4.0.3/dist/web3.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bad-words@3.0.4/lib/bad-words.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Creepster&family=Press+Start+2P&display=swap');
    * { margin:0; padding:0; box-sizing:border-box; }
    body { background:#000; color:#0f0; font-family:'Press Start 2P', cursive; overflow:hidden; }
    
    #game { width:100vw; height:100vh; position:relative; display:flex; flex-direction:column; background:#111; }
    
    #zoltar { 
      flex:1; 
      background: url('https://i.imgur.com/0vM8w1K.jpg') center/contain no-repeat; /* CLEAN ZOLTAR FROM BIG */
      position:relative; filter: drop-shadow(0 0 30px #0f0);
    }
    #crystal { 
      position:absolute; top:35%; left:50%; transform:translateX(-50%); width:18%; 
      background:radial-gradient(circle at 30% 30%, #0ff, #00f); border-radius:50%; 
      box-shadow:0 0 40px #0ff; animation:pulse 2s infinite;
    }
    @keyframes pulse { 0%,100% { opacity:0.8; transform:scale(1); } 50% { opacity:1; transform:scale(1.1); } }
    
    #controls { 
      height:35%; background:#000; border-top:8px solid #0f0; padding:1rem; 
      display:flex; flex-direction:column; align-items:center; gap:1rem; position:relative;
    }
    #input-area { width:90%; display:flex; flex-direction:column; gap:0.5rem; }
    #question { 
      width:100%; height:60px; padding:0.8rem; font-size:0.9rem; background:#000; 
      border:3px solid #0f0; color:#0f0; font-family:'Press Start 2P'; border-radius:6px; resize:none;
    }
    #error { color:#f00; font-size:0.7rem; text-align:center; }
    #coin-slot { 
      width:80px; height:80px; background:#333; border:5px solid #0f0; border-radius:50%; 
      position:relative; box-shadow:inset 0 0 20px #000, 0 0 20px #0f0;
    }
    #coin { 
      width:60px; height:60px; background:radial-gradient(#ffd700, #b8860b); border-radius:50%; 
      position:absolute; top:-100px; left:10px; box-shadow:0 0 30px #ff0; opacity:0;
    }
    #pay-button { 
      background:#ff0; color:#000; padding:0.8rem 1.8rem; font-size:1rem; border:none; 
      border-radius:50px; cursor:pointer; box-shadow:0 0 25px #ff0; font-weight:bold; position:absolute; bottom:1rem;
    }
    
    #connect-wallet { 
      position:absolute; top:0.5rem; right:0.5rem; background:#0f0; color:#000; 
      padding:0.4rem 0.8rem; font-size:0.7rem; border:none; border-radius:4px; cursor:pointer;
    }
    #status { 
      position:absolute; top:0.5rem; left:0.5rem; background:rgba(0,0,0,0.8); padding:0.4rem; 
      border-radius:4px; font-size:0.6rem; color:#ff0;
    }

    #fortune { 
      position:absolute; bottom:8%; left:5%; right:5%; background:#000; padding:1.2rem; 
      border:4px double #0f0; border-radius:10px; display:none; font-size:0.9rem; text-align:center; 
      opacity:0; z-index:100; box-shadow:0 0 40px #0f0;
    }
    #share-btn { margin-top:0.8rem; background:#ff0; color:#000; padding:0.4rem 0.8rem; border:none; border-radius:50px; cursor:pointer; font-size:0.7rem; }

    @media (max-width:768px) {
      #question { font-size:0.8rem; height:50px; }
      #pay-button { font-size:0.9rem; }
      #coin-slot { width:60px; height:60px; }
    }
  </style>
</head>
<body>

<div id="game">
  <div id="zoltar">
    <div id="crystal"></div>
  </div>

  <div id="controls">
    <div id="input-area">
      <textarea id="question" placeholder="Ask your fate..."></textarea>
      <div id="error"></div>
    </div>
    <div id="coin-slot">
      <div id="coin"></div>
    </div>
    <button id="pay-button" onclick="validateAndSpin()">INSERT $10 ETH</button>
  </div>

  <div id="status">
    Pool: $<span id="pool-value">0</span> | Tokens: <span id="tokens-left">1,000,000,000</span>
  </div>

  <button id="connect-wallet" onclick="connectMetaMask()">CONNECT</button>

  <div id="fortune">
    <div id="answer-text"></div>
    <div id="airdrop-info" style="margin:1rem 0; color:#ff0; font-size:0.8rem;"></div>
    <button id="share-btn" onclick="shareFortune()">SHARE</button>
  </div>
</div>

<script>
  let web3 = null;
  let userAddress = null;
  let poolETH = 0;
  let tokensDistributed = 0;
  let randomTokens = 0;
  const TOTAL_SUPPLY = 1000000000;

  const filter = new BadWords();
  const QUESTION_STARTERS = ["what","when","where","who","why","how","will","should","can","could","would","is","are","do","does"];

  async function connectMetaMask() {
    if (!window.ethereum) {
      alert("Install MetaMask: https://metamask.io");
      return;
    }

    try {
      const accounts = await window.ethereum.request({ method: 'eth_requestAccounts' });
      web3 = new Web3(window.ethereum);
      userAddress = accounts[0];

      try {
        await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: '0x2105' }] });
      } catch (e) {
        if (e.code === 4902) {
          await window.ethereum.request({
            method: 'wallet_addEthereumChain',
            params: [{
              chainId: '0x2105',
              chainName: 'Base',
              rpcUrls: ['https://mainnet.base.org'],
              nativeCurrency: { name: 'ETH', symbol: 'ETH', decimals: 18 },
              blockExplorerUrls: ['https://basescan.org']
            }]
          });
        }
      }

      document.getElementById('connect-wallet').innerHTML = `Connected: ${userAddress.slice(0,6)}...`;
    } catch (error) {
      alert("Connection failed: " + error.message);
    }
  }

  function validateInput() {
    const q = document.getElementById('question').value.trim().toLowerCase();
    const error = document.getElementById('error');
    if (!q.endsWith('?')) { error.innerText = "End with ?"; error.style.display = 'block'; return false; }
    if (!QUESTION_STARTERS.some(w => q.startsWith(w + " "))) { error.innerText = "Start with What, Will, etc."; error.style.display = 'block'; return false; }
    if (filter.isProfane(q)) { error.innerText = "No profanity."; error.style.display = 'block'; return false; }
    error.style.display = 'none';
    return true;
  }

  async function validateAndSpin() {
    if (!userAddress) return alert("Connect wallet!");
    if (!validateInput()) return;

    if (!confirm("DEMO MODE: No real ETH. Continue?")) return;

    const coin = document.getElementById('coin');
    coin.style.opacity = 1;
    gsap.fromTo(coin, { y: -150 }, { y: 80, duration: 1.2, ease: "bounce.out", onComplete: () => coin.style.opacity = 0 });

    gsap.to("#crystal", { scale: 1.2, duration: 0.5, yoyo: true, repeat: 3 });

    poolETH += 0.003 * 0.3;
    document.getElementById('pool-value').innerText = Math.floor(poolETH * 3300);

    setTimeout(revealFortune, 1500);
  }

  function revealFortune() {
    randomTokens = Math.floor(Math.random() * 10000) + 1;
    tokensDistributed += randomTokens;
    document.getElementById('tokens-left').innerText = (TOTAL_SUPPLY - tokensDistributed).toLocaleString();

    const answers = [
      "The crystal ball glows... A new path opens in 7 days. ‚≠ê",
      "Love arrives with a stranger. Look for green eyes. üåô",
      "Fortune favors the bold. Take the leap. ü™ê"
    ];
    const answer = answers[Math.floor(Math.random() * answers.length)];

    const fortune = document.getElementById('fortune');
    document.getElementById('answer-text').innerHTML = `<strong>ZOLTAR:</strong><br><br>${answer}`;
    document.getElementById('airdrop-info').innerHTML = `You won <strong>${randomTokens.toLocaleString()} $FORTUNE</strong>!`;
    fortune.style.display = 'block';
    gsap.fromTo(fortune, { opacity: 0, y: 30 }, { opacity: 1, y: 0, duration: 1.2, ease: "power2.out" });
  }

  function shareFortune() {
    const text = `ZOLTAR SAID:\n"${document.getElementById('question').value}"\n\nI WON ${randomTokens.toLocaleString()} $FORTUNE!\n\nPlay: https://zoltar-oracle-2025.vercel.app`;
    navigator.clipboard.writeText(text);
    alert("Copied!");
  }
</script>

</body>
</html>
